# Architecture & Data Flow Diagrams

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (Browser)                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         User Input (Text or Voice)                  â”‚  â”‚
â”‚  â”‚                                                     â”‚  â”‚
â”‚  â”‚  [Text Mode] â†â†’ [Voice Mode ğŸ¤]                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Message Processing                              â”‚  â”‚
â”‚  â”‚  - Add to chat display                             â”‚  â”‚
â”‚  â”‚  - Track emotions                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                    â”‚
â”‚                    HTTP POST                               â”‚
â”‚                       â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BACKEND (Flask)                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /api/chat (Process Message)                        â”‚  â”‚
â”‚  â”‚  - Get conversation history                         â”‚  â”‚
â”‚  â”‚  - Call Ollama AI                                   â”‚  â”‚
â”‚  â”‚  - Generate response                                â”‚  â”‚
â”‚  â”‚  - Return response text                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                    â”‚
â”‚                    Response with text                      â”‚
â”‚                       â”‚                                    â”‚
â”‚                       â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /api/tts (Text-to-Speech) â­ NEW                   â”‚  â”‚
â”‚  â”‚                                                     â”‚  â”‚
â”‚  â”‚  1. Receive text (Tamil/English/Hindi)             â”‚  â”‚
â”‚  â”‚  2. Detect language via LanguageDetector            â”‚  â”‚
â”‚  â”‚  3. Map to gTTS language code                       â”‚  â”‚
â”‚  â”‚  4. Generate speech via gTTS                        â”‚  â”‚
â”‚  â”‚  5. Return MP3 audio stream                         â”‚  â”‚
â”‚  â”‚                                                     â”‚  â”‚
â”‚  â”‚  Supported: 'ta' (Tamil), 'hi' (Hindi), 'en'       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (Browser)                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Display Response Text                              â”‚  â”‚
â”‚  â”‚  + Play Audio via Web Audio API                     â”‚  â”‚
â”‚  â”‚                                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Audio Playback Flow                        â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                            â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ Blob â†’ ObjectURL â†’ Audio Element â†’ Play   â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  âœ… User hears AI response                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Text-to-Speech Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Response Text (Any Language)                               â”‚
â”‚ Example: "à®µà®£à®•à¯à®•à®®à¯, à®¨à¯€ à®à®ªà¯à®ªà®Ÿà®¿ à®‡à®°à¯à®•à¯à®•à®¿à®±à®¾à®¯à¯?"                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  speakText()     â”‚
        â”‚  (Frontend)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ POST /api/tts                        â”‚
        â”‚ { "text": "à®µà®£à®•à¯à®•à®®à¯, ..." }           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼ (Backend)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ detect_language(text)       â”‚
    â”‚                             â”‚
    â”‚ Check Unicode ranges:       â”‚
    â”‚ - Tamil: 0B80-0BFF          â”‚
    â”‚ - Marathi: 0900-097F        â”‚
    â”‚ - English: ASCII            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Map Language to gTTS Code   â”‚
    â”‚                             â”‚
    â”‚ ta â†’ 'ta'  (Tamil)          â”‚
    â”‚ mr â†’ 'hi'  (Hindi fallback) â”‚
    â”‚ en â†’ 'en'  (English)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ gTTS(text, lang='ta')       â”‚
    â”‚                             â”‚
    â”‚ Generate MP3 audio          â”‚
    â”‚ in memory (BytesIO)         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ send_file(                  â”‚
    â”‚   audio_buffer,             â”‚
    â”‚   mimetype='audio/mp3'      â”‚
    â”‚ )                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    Return MP3 audio stream
             â”‚
             â–¼ (Frontend)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ response.blob()              â”‚
    â”‚ â†’ ObjectURL                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ new Audio(audioUrl)          â”‚
    â”‚ audio.play()                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
         ğŸ”Š Sound plays!
```

---

## Voice Input with TTS Response Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Clicks Microphone Button ğŸ¤                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Request Microphone       â”‚
     â”‚ Permission               â”‚
     â”‚ navigator.mediaDevices   â”‚
     â”‚ .getUserMedia()          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
         â”‚          â”‚
         â–¼          â–¼
    âœ… Allowed  âŒ Denied
         â”‚          â”‚
         â”‚          â””â”€â”€â†’ Show Error: "Microphone denied"
         â”‚
         â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Initialize Speech       â”‚
     â”‚ Recognition             â”‚
     â”‚                         â”‚
     â”‚ speechRecognition       â”‚
     â”‚ .start()                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Browser Records Audio       â”‚
    â”‚ Shows: "ğŸ¤ Listening..."    â”‚
    â”‚                             â”‚
    â”‚ Interim Results Display:    â”‚
    â”‚ "ğŸ¤ hello how..."           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ (User stops speaking)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Final Transcript             â”‚
    â”‚ "hello how are you"          â”‚
    â”‚                              â”‚
    â”‚ Shows: "âœ“ Sending..."        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
      POST /api/chat
             â”‚
             â–¼ (Backend)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Generate AI Response:        â”‚
    â”‚ "I'm doing great, thanks!"   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
      JSON Response
             â”‚
             â–¼ (Frontend)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Display Text Response             â”‚
    â”‚ + Call speakText(response)        â”‚
    â”‚                                  â”‚
    â”‚ â†’ Calls /api/tts                 â”‚
    â”‚ â†’ Gets MP3 audio                 â”‚
    â”‚ â†’ Plays audio                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
         ğŸ”Š User hears response!
```

---

## Microphone Permission Handling

```
Click ğŸ¤ Button
    â”‚
    â–¼
Check Browser Support
    â”‚
    â”œâ”€â†’ Not Supported: Show Error
    â”‚
    â”œâ”€â†’ Supported
    â”‚
    â–¼
Request Permission: getUserMedia({ audio: {...} })
    â”‚
    â”œâ”€â†’ AudioContext not initialized
    â”‚   â””â”€â†’ Initialize Web Audio API
    â”‚
    â”œâ”€â†’ Permission Denied (NotAllowedError)
    â”‚   â””â”€â†’ Show: "Enable microphone in browser settings"
    â”‚
    â”œâ”€â†’ No Device (NotFoundError)
    â”‚   â””â”€â†’ Show: "No microphone found"
    â”‚
    â”œâ”€â†’ Other Error
    â”‚   â””â”€â†’ Show: "Error: " + error message
    â”‚
    â”œâ”€â†’ âœ… Permission Granted
    â”‚
    â–¼
Stop MediaStream (we just needed permission)
stream.getTracks().forEach(track => track.stop())
    â”‚
    â–¼
Start Speech Recognition
speechRecognition.start()
    â”‚
    â–¼
ğŸ¤ Listen for speech...
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Action                  â”‚
â”‚ (Send message, Record audio) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Try Operation     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚
    â–¼                    â–¼
Success            Error/Exception
    â”‚                    â”‚
    â”‚                    â”œâ”€â†’ Type: NotAllowedError
    â”‚                    â”‚   â””â”€â†’ "Microphone permission denied"
    â”‚                    â”‚
    â”‚                    â”œâ”€â†’ Type: NotFoundError
    â”‚                    â”‚   â””â”€â†’ "No microphone found"
    â”‚                    â”‚
    â”‚                    â”œâ”€â†’ Error: 'not-allowed'
    â”‚                    â”‚   â””â”€â†’ "Permission denied for recognition"
    â”‚                    â”‚
    â”‚                    â”œâ”€â†’ Error: 'no-speech'
    â”‚                    â”‚   â””â”€â†’ "No speech detected"
    â”‚                    â”‚
    â”‚                    â”œâ”€â†’ Error: 'network'
    â”‚                    â”‚   â””â”€â†’ "Network connection error"
    â”‚                    â”‚
    â”‚                    â”œâ”€â†’ TTS Fetch Error
    â”‚                    â”‚   â””â”€â†’ fallbackTTS(text)
    â”‚                    â”‚
    â”‚                    â””â”€â†’ Other Error
    â”‚                        â””â”€â†’ Log to console + alert user
    â”‚
    â–¼
Continue or Retry
```

---

## Language Detection Logic

```
Input Text
    â”‚
    â–¼
Count Characters by Language
    â”‚
    â”œâ”€â†’ Count Tamil chars (0B80-0BFF)
    â”‚   Example: "à®µà®£à®•à¯à®•à®®à¯" â†’ 5 Tamil chars
    â”‚
    â”œâ”€â†’ Count Marathi chars (0900-097F)
    â”‚   Example: "à¤¨à¤®à¤¸à¥à¤¤à¥‡" â†’ 3 Marathi chars
    â”‚
    â”œâ”€â†’ Count total non-space chars
    â”‚
    â–¼
Calculate Percentages
    â”‚
    â”œâ”€â†’ If Tamil > 30% â†’ Language = 'ta'
    â”‚   â”œâ”€â†’ gTTS Code = 'ta'
    â”‚   â””â”€â†’ Speech Recognition = 'ta-IN'
    â”‚
    â”œâ”€â†’ Else if Marathi > 30% â†’ Language = 'mr'
    â”‚   â”œâ”€â†’ gTTS Code = 'hi' (Hindi fallback)
    â”‚   â””â”€â†’ Speech Recognition = 'hi-IN'
    â”‚
    â””â”€â†’ Else â†’ Language = 'en' (Default)
        â”œâ”€â†’ gTTS Code = 'en'
        â””â”€â†’ Speech Recognition = 'en-US'

Example:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Input: "à®µà®£à®•à¯à®•à®®à¯, how are you?"           â”‚
â”‚                                          â”‚
â”‚ Tamil chars: 5                           â”‚
â”‚ Total chars: 18                          â”‚
â”‚ Percentage: 5/18 = 27% (< 30%)         â”‚
â”‚ Result: English mode (mixed text)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Input: "à®µà®£à®•à¯à®•à®®à¯, à®¨à¯€ à®à®ªà¯à®ªà®Ÿà®¿ à®‡à®°à¯à®•à¯à®•à®¿à®±à®¾à®¯à¯?" â”‚
â”‚                                          â”‚
â”‚ Tamil chars: 20                          â”‚
â”‚ Total chars: 22                          â”‚
â”‚ Percentage: 20/22 = 91% (> 30%)        â”‚
â”‚ Result: Tamil mode                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Browser Support Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser         â”‚ Web API  â”‚ TTS Support â”‚ STT Support  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Chrome          â”‚ âœ… Full  â”‚ âœ… Full     â”‚ âœ… Full      â”‚
â”‚ Edge            â”‚ âœ… Full  â”‚ âœ… Full     â”‚ âœ… Full      â”‚
â”‚ Safari (macOS)  â”‚ âœ… Basic â”‚ âœ… Basic    â”‚ âš ï¸ Limited   â”‚
â”‚ Safari (iOS)    â”‚ âœ… Basic â”‚ âœ… Basic    â”‚ âš ï¸ Limited   â”‚
â”‚ Firefox         â”‚ âš ï¸ Setup â”‚ âœ… Full     â”‚ âŒ No        â”‚
â”‚ Opera           â”‚ âœ… Full  â”‚ âœ… Full     â”‚ âœ… Full      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Recommendation: Use Chrome or Edge for best experience
```

---

## Audio Playback Pipeline

```
MP3 Stream from Server
    â”‚
    â–¼
response.blob()
â”‚
â”œâ”€ Blob: { type: 'audio/mp3', size: ... }
â”‚
â–¼
URL.createObjectURL(blob)
â”‚
â”œâ”€ Object URL: blob:http://localhost:5000/a1b2c3d4...
â”‚
â–¼
new Audio(objectUrl)
â”‚
â”œâ”€ Audio HTMLElement created
â”œâ”€ Set volume = 1.0
â”œâ”€ Set playbackRate = 0.85 (character specific)
â”‚
â–¼
audio.play()
â”‚
â”œâ”€ Promise resolves when playing
â”œâ”€ Promise rejects if blocked/error
â”‚
â–¼
Browser plays MP3
â”‚
â”œâ”€ Decoded via Web Audio API
â”œâ”€ Output to speakers via OS
â”‚
â–¼
ğŸ”Š User hears voice!
```

---

## State Management

```
Global Variables Tracking:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Voice/Microphone State                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ voiceMode: boolean                      â”‚
â”‚   - true: Listening mode                â”‚
â”‚   - false: Text input mode              â”‚
â”‚                                         â”‚
â”‚ isRecording: boolean                    â”‚
â”‚   - true: Currently recording           â”‚
â”‚   - false: Not recording                â”‚
â”‚                                         â”‚
â”‚ speechRecognition: SpeechRecognition    â”‚
â”‚   - Instance of Web Speech API          â”‚
â”‚   - null: Not initialized               â”‚
â”‚                                         â”‚
â”‚ audioChunks: Array<Uint8Array>         â”‚
â”‚   - Stores recorded audio data          â”‚
â”‚   - Used for audio processing           â”‚
â”‚                                         â”‚
â”‚ mediaRecorder: MediaRecorder            â”‚
â”‚   - Records audio from microphone       â”‚
â”‚   - null: Not initialized               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This architecture ensures:
- âœ… Reliable text-to-speech in multiple languages
- âœ… Robust microphone handling with clear feedback
- âœ… Graceful error handling with user-friendly messages
- âœ… Fallback mechanisms for browser compatibility
- âœ… Clear separation between frontend and backend
